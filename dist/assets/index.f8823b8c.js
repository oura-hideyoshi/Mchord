var A=Object.defineProperty,B=Object.defineProperties;var D=Object.getOwnPropertyDescriptors;var f=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var K=(e,o,n)=>o in e?A(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n,v=(e,o)=>{for(var n in o||(o={}))F.call(o,n)&&K(e,n,o[n]);if(f)for(var n of f(o))R.call(o,n)&&K(e,n,o[n]);return e},N=(e,o)=>B(e,D(o));var M=(e,o)=>{var n={};for(var s in e)F.call(e,s)&&o.indexOf(s)<0&&(n[s]=e[s]);if(e!=null&&f)for(var s of f(e))o.indexOf(s)<0&&R.call(e,s)&&(n[s]=e[s]);return n};import{U as C,i as p,j as t,H as G,c as y,r as u,u as E,F as O,a as d,P as S,b as P,d as V,e as I,f as H,g as U,R as z,h as q,k as Z,l as J,m as Q,n as W,o as X}from"./vendor.a12f7de4.js";const Y=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerpolicy&&(r.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?r.credentials="include":i.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}};Y();function T(e,o){return{id:C.generate(),position:e,data:o,type:"ChordNode"}}function $(e,o){return{id:C.generate(),position:e,data:{keySig:o.keySig,isMajor:o.isMajor,minorVariant:o.minorVariant||"natural"},type:"KeyNode"}}function w(e,o){const n=e==""?"C":p.majorTonicFromKeySignature(e);return o?p.majorKey(n):p.minorKey(n)}function _(e,o){return o?p.majorKey(e):p.minorKey(e)}function ee(e){return e.type=="ChordNode"}const b=e=>t(G,N(v({},e),{onClick:e.onClick,className:y({width:"10px",height:"100%",borderRadius:0,backgroundColor:"lightgray",transform:"translate(0%, -50%)",":hover":{borderColor:"gray"}})}));var oe=u.exports.memo(s=>{var i=s,{id:e,data:o}=i,n=M(i,["id","data"]);const[r,a]=u.exports.useState(w(o.keySig,o.isMajor)),[h,m]=u.exports.useState(o.isMajor),{setNodes:k,addNodes:x,addEdges:j}=E();u.exports.useEffect(()=>{k(c=>c.map(l=>(ee(l)&&(l.data=N(v({},l.data),{keySig:r.keySignature})),l)))},[r,h]);const g=()=>{const c=T({x:n.xPos+100,y:n.yPos},{chord:{typeName:"",optionalTonic:"C"},keySig:r.keySignature,isMajor:!0}),l={id:C.generate(),source:e,target:c.id};x(c),j(l)};return t(O,{children:d("div",{className:y({border:"solid 1px black",padding:"10px"}),children:[t(b,{type:"source",position:S.Right,onClick:g}),d("select",{name:"key",value:p.majorKey(r.tonic).keySignature,onChange:c=>a(w(c.target.value,h)),children:[t("option",{value:"",children:"C"}),t("option",{value:"##",children:"D"}),t("option",{value:"####",children:"E"}),t("option",{value:"b",children:"F"}),t("option",{value:"#",children:"G"}),t("option",{value:"###",children:"A"}),t("option",{value:"#####",children:"B"})]}),d("select",{name:"isMajor",value:r.type,onChange:c=>{const l=c.target.value=="major";m(l),a(_(r.tonic,l))},children:[t("option",{value:"major",children:"M"}),t("option",{value:"minor",children:"m"})]}),t("span",{className:y({marginLeft:"10px"}),children:"Key"})]})})}),te=u.exports.memo(s=>{var i=s,{id:e,data:o}=i,n=M(i,["id","data"]);const r=w(o.keySig,o.isMajor);o.isMajor;const[a,h]=u.exports.useState(P.getChord(o.chord.typeName,o.chord.optionalTonic,o.chord.optionalRoot)),m=V.toRomanNumerals(r.tonic,[a.name])[0],{addNodes:k,addEdges:x}=E(),j=()=>{const g=T({x:n.xPos+100,y:n.yPos},{chord:{typeName:"",optionalTonic:"C"},keySig:r.keySignature,isMajor:!0}),c={id:C.generate(),source:e,target:g.id};k(g),x(c)};return d("div",{className:y({border:"solid 1px black"}),children:[t(b,{type:"target",position:S.Left}),d("div",{className:y({paddingLeft:10,paddingRight:10}),children:[d("div",{children:[d("select",{name:"tonic",value:a.tonic,onChange:g=>h(P.getChord(a.type,g.target.value,a.root)),children:[t("option",{value:"C",children:"C"}),t("option",{value:"D",children:"D"}),t("option",{value:"E",children:"E"}),t("option",{value:"F",children:"F"}),t("option",{value:"G",children:"G"}),t("option",{value:"A",children:"A"}),t("option",{value:"B",children:"B"})]}),t("span",{children:a.type})]}),d("div",{children:[t("span",{children:m}),t("span",{children:o.keySig})]})]}),t(b,{type:"source",position:S.Right,onClick:j})]})});const ne={KeyNode:oe,ChordNode:te},ie=[20,20],L={sig:"#",isMajor:!0},re=()=>{const[e,o,n]=I([$({x:0,y:0},{keySig:L.sig,isMajor:L.isMajor})]),[s,i,r]=H([]);u.exports.useEffect(()=>{console.log("FlowView > useEffect(nodes) > nodes :",e)},[e]);const a=u.exports.useCallback(h=>i(m=>U(N(v({},h),{animated:!0}),m)),[]);return d(z,{nodes:e,edges:s,onNodesChange:n,onEdgesChange:r,onConnect:a,nodeTypes:ne,snapToGrid:!0,snapGrid:ie,defaultZoom:1.5,fitView:!0,attributionPosition:"bottom-left",children:[t(q,{}),t(Z,{}),t(J,{})]})},se=()=>{const e={sig:"#",isMajor:!0},{setNodes:o}=E();return d("div",{children:[t("button",{onClick:()=>console.clear(),children:"clear console"}),t("button",{onClick:()=>{o([$({x:0,y:0},{keySig:e.sig,isMajor:e.isMajor})])},children:"init"})]})},ae=()=>t("div",{className:y({display:"flex"}),children:d(Q,{children:[t("div",{style:{width:"80vw",height:"100vh"},children:t(re,{})}),t("div",{style:{width:"20vw",height:"100vh"},children:t(se,{})})]})});function de(){return t(ae,{})}W.render(t(X.StrictMode,{children:t(de,{})}),document.getElementById("root"));
